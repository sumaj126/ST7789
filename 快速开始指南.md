# 🚀 ESP32 + YS-IRTM 空调控制系统 - 快速开始

## 📦 硬件清单

| 硬件 | 数量 | 说明 |
|------|------|------|
| ESP32开发板 | 1 | 主控板 |
| ST7789 TFT屏幕 (240x240) | 1 | 显示屏 |
| DHT11温湿度传感器 | 1 | 温湿度检测 |
| YS-IRTM红外模块 | 1 | 红外收发 |
| 杜邦线 | 若干 | 连接线 |
| 面包板 | 1 | (可选) |

## 🔌 硬件连接图

```
┌─────────────────────────────────────────────────┐
│                    ESP32                        │
│                                                 │
│  ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐          │
│  │ TFT │  │ DHT │  │ IR  │  │ ... │          │
│  └─────┘  └─────┘  └─────┘  └─────┘          │
│     ↓         ↓         ↓                      │
│  GPIO5     GPIO14    GPIO16(RX)                │
│  GPIO2               GPIO17(TX)                │
│  GPIO15                                        │
│                                                 │
└─────────────────────────────────────────────────┘

ST7789连接:
  CS   → GPIO5
  DC   → GPIO2
  RST  → GPIO15
  VCC  → 3.3V
  GND  → GND
  SDA  → GPIO23
  SCL  → GPIO18

DHT11连接:
  DATA → GPIO14
  VCC  → 3.3V
  GND  → GND

YS-IRTM连接:
  TX   → GPIO16 (ESP32 RX2)
  RX   → GPIO17 (ESP32 TX2)
  VCC  → 3.3V
  GND  → GND
```

## 💻 软件安装

### 1. 准备开发环境
- 安装 PlatformIO
- 克隆/下载本项目
- 在 PlatformIO 中打开项目

### 2. 编译上传
```bash
# 在项目目录执行
pio run --target upload
```

### 3. 打开串口监视器
- 波特率: 115200
- 选择正确的COM端口

## 📚 使用步骤

### 第一步：测试模块

上传代码后，打开串口监视器，输入：
```
TEST_IR
```

如果看到模块版本信息，说明YS-IRTM模块正常工作。

### 第二步：学习海尔遥控器

1. 在串口监视器输入：
```
LEARN
```

2. 屏幕显示"红外学习模式"

3. 按顺序对准YS-IRTM模块按下遥控器按键：
   ```
   1. 电源    2. 温度+    3. 温度-    4. 模式
   5. 风速    6. 摆风    7. 强力    8. 睡眠
   ```

4. 每按一个键，串口会显示学习到的代码

5. 30秒无操作自动退出

6. 查看学习状态：
```
STATUS
```

### 第三步：测试控制

测试发送红外代码：
```
SEND_1      # 发送电源键
SEND_2      # 发送温度+
SEND_3      # 发送温度-
```

### 第四步：空调控制

基础控制命令：
```
ON          # 空调电源开关
TEMP_26     # 设置温度26度
AC_FAN_HIGH # 高风速
```

查看所有命令：
```
HELP
```

## 🎯 常用命令速查

| 命令 | 功能 | 说明 |
|------|------|------|
| `LEARN` | 进入学习 | 学习遥控器按键 |
| `CLEAR` | 清除数据 | 清除已学习代码 |
| `STATUS` | 查看状态 | 显示学习按键列表 |
| `SEND_1` ~ `SEND_16` | 发送按键 | 发送学习按键1-16 |
| `ON` | 电源开关 | 开关空调 |
| `TEMP_XX` | 设置温度 | XX为16-30 |
| `AC_MODE_COOL` | 制冷模式 | 切换到制冷 |
| `AC_FAN_HIGH` | 高风速 | 设置高风速 |
| `TEST_IR` | 测试模块 | 查询模块状态 |
| `HELP` | 帮助 | 显示所有命令 |

## 📺 屏幕显示说明

```
┌──────────────────────────┐
│  空调: 已学习            │  ← 空调状态条
│  已学按键: 8             │
├──────────────────────────┤
│  2025-01-27              │  ← 日期
│  周二                    │
├──────────────────────────┤
│     14:30:25             │  ← 时间
├──────────────────────────┤
│  温度    湿度            │
│  26.5°C  65.2%           │  ← 温湿度
└──────────────────────────┘
```

## 🛠️ 故障排除

### 问题1：串口无响应
```
检查：
1. USB线是否连接
2. COM端口是否正确
3. 波特率是否115200
4. 按ESP32复位键
```

### 问题2：学习失败
```
检查：
1. YS-IRTM电源是否正常
2. 遥控器对准模块距离5-10cm
3. 模块LED是否闪烁
4. 输入TEST_IR测试模块
```

### 问题3：空调无响应
```
检查：
1. 空调电源是否打开
2. 模块对准空调3-5米
3. 对准空调右侧接收器
4. 学习代码是否正确(STATUS)
```

### 问题4：屏幕不显示
```
检查：
1. ST7789接线是否正确
2. 3.3V供电是否稳定
3. 检查SDA/SCL引脚
```

## 🎓 进阶应用

### 1. 自动温控
在 `updateTempHumi()` 函数中添加：
```cpp
if (temperature > 28 && !acState.power) {
  sendHaierACCommand(0);  // 开启空调
}
```

### 2. 定时开关
在 `loop()` 中添加时间判断：
```cpp
int hour = timeClient.getHours();
if (hour == 9) {
  sendHaierACCommand(0);  // 9点开机
}
```

### 3. Web控制
添加WebServer实现手机控制（见扩展文档）

## 📖 相关文档

- `YS-IRTM使用说明.md` - 详细技术文档
- `YS-IRTM串口控制示例.txt` - 串口命令代码
- `红外空调控制说明.md` - 通用红外方案

## 💡 提示

1. **学习时**：遥控器按键后松开，不要长按
2. **发送时**：对准空调接收器，通常在右侧面板
3. **距离**：学习5-10cm，发射3-5米
4. **防干扰**：避免其他红外信号（电视遥控器等）
5. **测试**：先用短距离测试，确认功能后再放远

## 📞 技术支持

- 查看串口输出调试信息
- 检查YS-IRTM模块LED指示灯
- 参考YS-IRTM官方文档
- 在线搜索"ESP32 YS-IRTM教程"

---

**祝您使用愉快！** 🎉
