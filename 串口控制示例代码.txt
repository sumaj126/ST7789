// æ·»åŠ åœ¨ main.cpp çš„ loop() å‡½æ•°ä¸­ï¼Œåœ¨çº¢å¤–å­¦ä¹ æ£€æŸ¥ä¹‹åŽæ·»åŠ ï¼š

// ä¸²å£å‘½ä»¤å¤„ç†ï¼ˆæ·»åŠ åœ¨ loop() å‡½æ•°çš„ if (irrecv.decode(&results)) ä¹‹åŽï¼‰
if (Serial.available()) {
  String cmd = Serial.readStringUntil('\n');
  cmd.trim();
  cmd.toUpperCase();  // è½¬æ¢ä¸ºå¤§å†™ï¼Œæ–¹ä¾¿è¾“å…¥

  Serial.println("ðŸ“¨ æ”¶åˆ°å‘½ä»¤: " + cmd);

  // ç”µæºæŽ§åˆ¶
  if (cmd == "AC_POWER_ON" || cmd == "AC_ON" || cmd == "ON") {
    acState.power = true;
    sendHaierACCommand(acState);
    Serial.println("âœ… ç©ºè°ƒå·²å¼€å¯");
  }
  else if (cmd == "AC_POWER_OFF" || cmd == "AC_OFF" || cmd == "OFF") {
    acState.power = false;
    sendHaierACCommand(acState);
    Serial.println("âœ… ç©ºè°ƒå·²å…³é—­");
  }

  // æ¸©åº¦æŽ§åˆ¶ (èŒƒå›´ 16-30)
  else if (cmd.startsWith("AC_TEMP_") || cmd.startsWith("TEMP_")) {
    int temp = cmd.substring(cmd.lastIndexOf('_') + 1).toInt();
    if (temp >= 16 && temp <= 30) {
      acState.power = true;
      acState.temp = temp;
      sendHaierACCommand(acState);
      Serial.printf("âœ… æ¸©åº¦è®¾ç½®ä¸º %dÂ°C\n", temp);
    } else {
      Serial.println("âŒ æ¸©åº¦èŒƒå›´é”™è¯¯ (16-30Â°C)");
    }
  }

  // æ¨¡å¼æŽ§åˆ¶
  else if (cmd == "AC_MODE_AUTO") {
    acState.power = true;
    acState.mode = 0;
    sendHaierACCommand(acState);
    Serial.println("âœ… æ¨¡å¼: è‡ªåŠ¨");
  }
  else if (cmd == "AC_MODE_COOL") {
    acState.power = true;
    acState.mode = 1;
    sendHaierACCommand(acState);
    Serial.println("âœ… æ¨¡å¼: åˆ¶å†·");
  }
  else if (cmd == "AC_MODE_HEAT") {
    acState.power = true;
    acState.mode = 2;
    sendHaierACCommand(acState);
    Serial.println("âœ… æ¨¡å¼: åˆ¶çƒ­");
  }
  else if (cmd == "AC_MODE_DRY") {
    acState.power = true;
    acState.mode = 3;
    sendHaierACCommand(acState);
    Serial.println("âœ… æ¨¡å¼: é™¤æ¹¿");
  }
  else if (cmd == "AC_MODE_FAN") {
    acState.power = true;
    acState.mode = 4;
    sendHaierACCommand(acState);
    Serial.println("âœ… æ¨¡å¼: é€é£Ž");
  }

  // é£Žé€ŸæŽ§åˆ¶
  else if (cmd == "AC_FAN_AUTO") {
    acState.fanSpeed = 0;
    sendHaierACCommand(acState);
    Serial.println("âœ… é£Žé€Ÿ: è‡ªåŠ¨");
  }
  else if (cmd == "AC_FAN_LOW") {
    acState.fanSpeed = 1;
    sendHaierACCommand(acState);
    Serial.println("âœ… é£Žé€Ÿ: ä½Ž");
  }
  else if (cmd == "AC_FAN_MEDIUM" || cmd == "AC_FAN_MED") {
    acState.fanSpeed = 2;
    sendHaierACCommand(acState);
    Serial.println("âœ… é£Žé€Ÿ: ä¸­");
  }
  else if (cmd == "AC_FAN_HIGH") {
    acState.fanSpeed = 3;
    sendHaierACCommand(acState);
    Serial.println("âœ… é£Žé€Ÿ: é«˜");
  }

  // å…¶ä»–åŠŸèƒ½
  else if (cmd == "AC_SWING_ON") {
    acState.swing = true;
    sendHaierACCommand(acState);
    Serial.println("âœ… æ‘†é£Ž: å¼€å¯");
  }
  else if (cmd == "AC_SWING_OFF") {
    acState.swing = false;
    sendHaierACCommand(acState);
    Serial.println("âœ… æ‘†é£Ž: å…³é—­");
  }
  else if (cmd == "AC_TURBO_ON") {
    acState.turbo = true;
    sendHaierACCommand(acState);
    Serial.println("âœ… å¼ºåŠ›: å¼€å¯");
  }
  else if (cmd == "AC_TURBO_OFF") {
    acState.turbo = false;
    sendHaierACCommand(acState);
    Serial.println("âœ… å¼ºåŠ›: å…³é—­");
  }
  else if (cmd == "AC_SLEEP_ON") {
    acState.sleep = true;
    sendHaierACCommand(acState);
    Serial.println("âœ… ç¡çœ : å¼€å¯");
  }
  else if (cmd == "AC_SLEEP_OFF") {
    acState.sleep = false;
    sendHaierACCommand(acState);
    Serial.println("âœ… ç¡çœ : å…³é—­");
  }

  // çŠ¶æ€æŸ¥è¯¢
  else if (cmd == "AC_STATUS" || cmd == "STATUS") {
    Serial.println("\n========== ç©ºè°ƒçŠ¶æ€ ==========");
    Serial.printf("ç”µæº: %s\n", acState.power ? "å¼€å¯" : "å…³é—­");
    Serial.printf("æ¸©åº¦: %dÂ°C\n", acState.temp);
    const char* modes[] = {"è‡ªåŠ¨", "åˆ¶å†·", "åˆ¶çƒ­", "é™¤æ¹¿", "é€é£Ž"};
    Serial.printf("æ¨¡å¼: %s\n", modes[acState.mode % 5]);
    const char* fans[] = {"è‡ªåŠ¨", "ä½Ž", "ä¸­", "é«˜"};
    Serial.printf("é£Žé€Ÿ: %s\n", fans[acState.fanSpeed % 4]);
    Serial.printf("æ‘†é£Ž: %s\n", acState.swing ? "å¼€å¯" : "å…³é—­");
    Serial.printf("å¼ºåŠ›: %s\n", acState.turbo ? "å¼€å¯" : "å…³é—­");
    Serial.printf("ç¡çœ : %s\n", acState.sleep ? "å¼€å¯" : "å…³é—­");
    Serial.printf("å­¦ä¹ ä»£ç æ•°: %d\n", codeCount);
    Serial.println("==============================\n");
  }

  // å­¦ä¹ æ¨¡å¼
  else if (cmd == "LEARN" || cmd == "LEARN_MODE") {
    irLearnMode = true;
    lastIrLearnTime = millis();
    codeCount = 0;  // æ¸…ç©ºä¹‹å‰çš„ä»£ç 
    displayIRLearnMode();
    Serial.println("ðŸŽ“ è¿›å…¥çº¢å¤–å­¦ä¹ æ¨¡å¼");
    Serial.println("   å¯¹å‡†æŽ¥æ”¶å™¨æŒ‰ä¸‹é¥æŽ§å™¨æŒ‰é”®");
    Serial.println("   30ç§’è¶…æ—¶è‡ªåŠ¨é€€å‡º");
  }

  // å¸®åŠ©
  else if (cmd == "HELP" || cmd == "?") {
    Serial.println("\n========== å¯ç”¨å‘½ä»¤ ==========");
    Serial.println("ç”µæº:");
    Serial.println("  AC_ON / ON          - å¼€å¯ç©ºè°ƒ");
    Serial.println("  AC_OFF / OFF        - å…³é—­ç©ºè°ƒ");
    Serial.println("æ¸©åº¦ (16-30Â°C):");
    Serial.println("  AC_TEMP_26 / TEMP_26- è®¾ç½®æ¸©åº¦26Â°C");
    Serial.println("æ¨¡å¼:");
    Serial.println("  AC_MODE_AUTO        - è‡ªåŠ¨æ¨¡å¼");
    Serial.println("  AC_MODE_COOL        - åˆ¶å†·æ¨¡å¼");
    Serial.println("  AC_MODE_HEAT        - åˆ¶çƒ­æ¨¡å¼");
    Serial.println("  AC_MODE_DRY         - é™¤æ¹¿æ¨¡å¼");
    Serial.println("  AC_MODE_FAN         - é€é£Žæ¨¡å¼");
    Serial.println("é£Žé€Ÿ:");
    Serial.println("  AC_FAN_AUTO         - è‡ªåŠ¨é£Žé€Ÿ");
    Serial.println("  AC_FAN_LOW          - ä½Žé£Žé€Ÿ");
    Serial.println("  AC_FAN_MEDIUM       - ä¸­é£Žé€Ÿ");
    Serial.println("  AC_FAN_HIGH         - é«˜é£Žé€Ÿ");
    Serial.println("å…¶ä»–:");
    Serial.println("  AC_SWING_ON/OFF     - æ‘†é£Žå¼€å…³");
    Serial.println("  AC_TURBO_ON/OFF     - å¼ºåŠ›å¼€å…³");
    Serial.println("  AC_SLEEP_ON/OFF     - ç¡çœ å¼€å…³");
    Serial.println("  AC_STATUS / STATUS  - æŸ¥çœ‹çŠ¶æ€");
    Serial.println("  LEARN / LEARN_MODE  - çº¢å¤–å­¦ä¹ æ¨¡å¼");
    Serial.println("  HELP / ?            - æ˜¾ç¤ºå¸®åŠ©");
    Serial.println("==============================\n");
  }

  else if (cmd != "") {
    Serial.println("âŒ æœªçŸ¥å‘½ä»¤ï¼Œè¾“å…¥ HELP æŸ¥çœ‹å¯ç”¨å‘½ä»¤");
  }
}

// æ·»åŠ ä¸€ä¸ªå‡½æ•°åœ¨ setup() çš„æœ€åŽï¼Œæ˜¾ç¤ºå¯åŠ¨ä¿¡æ¯ï¼š
void printStartupInfo() {
  Serial.println("\n========================================");
  Serial.println("ðŸ  ESP32 çº¢å¤–ç©ºè°ƒæŽ§åˆ¶ç³»ç»Ÿ");
  Serial.println("========================================");
  Serial.println("ðŸ“¡ çº¢å¤–å­¦ä¹ :");
  Serial.println("   1. ä¸²å£è¾“å…¥ LEARN è¿›å…¥å­¦ä¹ æ¨¡å¼");
  Serial.println("   2. å¯¹å‡†æŽ¥æ”¶å™¨æŒ‰ä¸‹é¥æŽ§å™¨æŒ‰é”®");
  Serial.println("   3. 30ç§’è¶…æ—¶è‡ªåŠ¨é€€å‡º");
  Serial.println("ðŸ’¡ ç©ºè°ƒæŽ§åˆ¶:");
  Serial.println("   ä¸²å£è¾“å…¥ HELP æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤");
  Serial.println("========================================\n");
}

// åœ¨ setup() å‡½æ•°æœ€åŽè°ƒç”¨ï¼š
// printStartupInfo();
